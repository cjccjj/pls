#!/usr/bin/expect -f

# --------------------------
# Global human-like delay
# --------------------------
rename send original_send
proc send {args} {
    uplevel 1 [list original_send {*}$args]
    after 500       ;# wait 500ms after every send
}

# Optional: wait for slow AI responses
set timeout 25

# with default openai_1 profile, cmd generate and edit 
spawn ./pls

expect ">>"
send "run shell command of printf 'It'\''s done\n'\r"
expect "printf" 
send "y\r"
expect "It's done"
send "e\r"
expect "edit:" 
send "# edited\r"
expect "updated cmd:" 
send "y\r"
expect "It's done"
send "e\r"
expect "edit:" 
send "\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b"
send "echo test\r"
expect "echo test" 
send "y\r"
expect "Command succeeded"

# talk to change to openai_2 profile
send "change active profile to openai_2\r"
expect "pls.conf"
send "use BSD/macOS style\r"
expect "pls.conf"
send "y\r"
expect "Command succeeded"
send "q\r"
expect "bye"

# restart with openai_2 profile
spawn ./pls
expect ">>"
send "show files\r"
expect "cmd"

# talk to change to gemini_1 profile
send "change active profile to gemini_1\r"
expect "pls.conf"
send "y\r"
expect "Command succeeded"
send "q\r"
expect "bye"

# restart with gemini_1 profile
spawn ./pls
expect ">>"
send "delete all chat history\r"
expect "pls.log"
send "y\r"
expect "Command succeeded"
send "what we talked about?\r"
expect "We discussed"
send "q\r"
expect "bye"

expect eof
